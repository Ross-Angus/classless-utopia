@use "../mixins/shapes.scss";

// This is a problematic technique:
// https://css-tricks.com/using-css-transitions-auto-dimensions/
// Issues:
// * Due to the markup structure of the `details` element, the `max-height`
//   also includes the height of the `summary` element. This means that the
//   small `max-height` value below need to take account of how much content
//   might be inside that element and how many times it might wrap
// * The hard-coded `max-height` value of the maximum might be too small for
//   the content inside the `details` element
// * Because the transition is between the larger and smaller values, the
//   transition starts from 99em and ends at 6em, but only part of that
//   is visible to the user. This means it appears to start late.
// * It only seems to work in one direction
details {
  border: solid var(--keyline) var(--bodytext);
  margin: 0 0 var(--gutter);
  max-height: 6em;
  overflow: hidden;
  padding: var(--gutter);
  transition: max-height 0.5s;

  // Adjacent `details` are flush with each other, if both have a `name`
  // attribute (the `name` doesn't have to have the same value)
  &[name] + details[name] {
    margin-top: calc((var(--gutter) + var(--keyline)) * -1);
  }

  summary {
    margin: calc(var(--gutter) * -1);
    // To leave space for the vertical chevron
    padding: var(--gutter) calc(var(--gutter) * 2) var(--gutter) var(--gutter);
    position: relative;

    &::marker {
      content: none;
    }

    // ^ or v: vertical chevron button, reusing some declarations from
    // the navigation.
    // As the container is an unknown size, we need to have other
    // left and top values.
    &::before,
    &::after {
      @extend %btn-chevron-closed-pseudo;
      content: "";
      position: absolute;
      // Magic numbers alarm
      top: calc(var(--gutter) * 1.6);
    }

    // \
    &::before {
      @extend %btn-chevron-se;
      right: calc((var(--gutter) / 2) + var(--gutter));
    }

    // /
    &:after {
      @extend %btn-chevron-ne;
      right: var(--gutter);
    }
  }

  &[open] {
    max-height: 99em;
    transition: max-height 0.5s;

    summary {
      border-bottom: solid var(--keyline) var(--tint2);
      margin-bottom: var(--gutter);
      // /
      &:before {
        @extend %btn-chevron-ne;
      }
      // \
      &:after {
        @extend %btn-chevron-se;
      }
    }
  }
}
