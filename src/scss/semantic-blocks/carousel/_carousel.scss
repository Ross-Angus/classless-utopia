@use "../../vars-sass" as v;
@use "../../mixins/carousel-inputs.scss";

[aria-roledescription="carousel"] {
  overflow: auto;

  [aria-roledescription="slide"] {
    flex: 100% 0 0;

    // Warning message for users of browsers which do not support this functionality
    &:first-child {
      &::before {
        background: var(--tint1);
        content: "⚠️ Your web browser does not support native CSS carousel functionality";
        display: block;
        font-size: var(--smalltext-size);
        line-height: var(--line-height-tight);
        margin: 0 0 var(--gutter);
        padding: var(--gutter);
      }
    }
  }
}

@media (width < v.$site-width) {
  // Usually, the flexbox grid stops working below this point
  [aria-roledescription="carousel"] {
    display: flex;
    gap: var(--gutter);
    & > div {
      display: block;
    }
    & > * {
      flex: 1;
    }
  }
}

@supports (scroll-marker-group: after) {
  @media (prefers-reduced-motion: no-preference) {
    [aria-roledescription="carousel"] {
      scroll-behavior: smooth;
    }
  }

  [aria-roledescription="carousel"] {
    // Revert to position-based approach - pseudo-elements seem buggy with multiple instances
    overflow: hidden;
    margin: 0 var(--btn-size) var(--gutter);
    padding: 0 var(--gutter);
    position: relative;
    scroll-marker-group: after;
    scroll-snap-type: x mandatory;
    /* Isolate this carousel's layout and styling */
    contain: layout style;

    [aria-roledescription="slide"] {
      scroll-snap-align: center;

      // Hide the warning message about lack of support
      &:first-child::before {
        display: none;
      }

      // The pips at the bottom of the carousel, for jumping to a slide
      &::scroll-marker {
        box-sizing: border-box;
        content: "";
        display: block;
        border: var(--keyline) solid var(--bodytext);
        min-height: var(--small-btn-size);
        border-radius: 100%;
        width: var(--small-btn-size);

        &:hover,
        &:focus-visible {
          @extend %carousel-focus !optional;
        }

        // This pip represents the currently visible pane
        &:target-current {
          border-width: calc(var(--keyline) * 2);
        }
      }
    }

    &::scroll-button(*) {
      aspect-ratio: 1;
      font-size: var(--largetext-size);
      position: absolute;
      top: 50%;
      transform: translate(0, -100%);
      /* Force the button to be contained within this carousel */
      contain: layout style;
      z-index: 1;

      &:disabled {
        opacity: var(--disabled);

        &:hover {
          background: var(--tint2);
          cursor: not-allowed;
          outline: none;
        }
      }

      &:hover,
      &:focus-visible {
        cursor: pointer;
        @extend %carousel-focus !optional;
      }
    }

    &::scroll-button(left) {
      content: "⟪";
      left: 0;
      /* Explicitly bind to this container */
      inset-inline-start: 0;
    }

    &::scroll-button(right) {
      content: "⟫";
      right: 0;
      /* Explicitly bind to this container */
      inset-inline-end: 0;
    }

    &::scroll-marker-group {
      display: flex;
      gap: var(--gutter);
      height: var(--small-btn-size);
      justify-content: center;
      margin: 0 0 var(--gutter);
    }
  }
}
